const e=new WeakMap,t={createHTML:e=>e},r='\na[href^="http"]:not([download]):not([target]),\na[href^="."]:not([download]):not([target]),\na[href^="/"]:not([download]):not([target])\n',n="\nform:not([target])\n",o="\n:focus,\n:hover,\nbutton[type=submit],\nbutton:not([type])",s="fetching",a="same-origin",i=1e3,c="follow",l=1/0,u=()=>{},h=console.error,d=e=>e,{defaults:f,fetch:p,listen:m,on:g,parse:w,sse:y,trigger:b,when:v}=function({anchor:f=r,className:p=s,credentials:g=a,focused:y=o,form:b=n,interval:v=i,onContract:q=u,onError:M=h,redirect:H=c,retries:P=l,window:R}){const D={className:p,credentials:g,interval:v,onContract:q,onError:M,redirect:H,retries:P,window:R,contracts:[],promise:Promise.resolve(),url:R.location.href},k={defaults(){k.on(f,(e=>{k.listen("click",e,(t=>k.fetch(E(D,e),t,e).catch(M)))})),k.on(b,(e=>{k.listen("submit",e,(t=>(e.querySelectorAll(".error").forEach((e=>e.remove())),k.fetch(E(D,e),t,e).catch(M))))}))},async fetch(e,t,r=t&&t.target){const n={...T,event:t,request:e,target:r,session:D};if(!t)return n.fetch();if(t.defaultPrevented||t.cancelBubble)return;const o="submit"===t.type?r.querySelector(y):r;return t.preventDefault(),D.promise=D.promise.then((async()=>{o.classList.add(p),await n.fetch(),o.classList.remove(p)})),D.promise},listen(e,t,r,n={}){const o=L[e],s=Array.isArray(o)?o.listener.bind(t,r):r;return S("addEventListener",e,t,s,n),()=>S("removeEventListener",e,t,s,n)},on(e,t){D.contracts.push({listener:t,selector:e}),D.onContract(e,t)},parse(r,n){const o=globalThis.document.createElement("body");return o.classList.add("anticore"),o.id=n,o.innerHTML=function(r,n){n&&n.createPolicy&&!e.has(n)&&e.set(n,n.createPolicy("anticore",t));return(e.get(n)||t).createHTML(r)}(r,globalThis.trustedTypes),o},when(e,{url:t},r,n=d){const o=`${new URL(r,t)}`;return k.on(e,(async(e,t)=>{const r=await import(o);return n(r.default,r)(e,t)}))},sse(e,t,r=w){const n=new globalThis.EventSource(e,t);let o=!1;return m("beforeunload",globalThis,(()=>{o=!0}),{once:true,passive:true}),m("message",n,(t=>{k.trigger(r(t.data,e),e)}),{passive:true}),m("error",n,(e=>{o||M(e)}),{passive:true}),n},trigger:(e=D.window.document,t=D.window.document.location.href)=>({...T,session:D}.trigger(e,t).catch(M))};return k}({window:"undefined"!=typeof globalThis&&globalThis}),T={event:null,target:null,request:null,session:null,retries:null,async fetch(){const{request:e,session:t}=this,{window:r}=t;let n;try{const t=await r.fetch(e.clone()),{url:o=e.url}=t,s=await t.text();n=w(s,o),await this.trigger(n,o)}catch(e){const{interval:r,retries:o=t.retries}=this;if(n||!o)return Promise.reject(e);this.retries-=1,console.log(`Retrying in ${r/1e3}s`),await function(e){return new Promise((t=>setTimeout(t,e)))}(r),await this.fetch()}},async trigger(e,t){const r=[];return this.session.contracts.forEach((({selector:t,listener:n})=>{r.push(...[...e.querySelectorAll(t)].map((e=>t=>n(e,t))))})),Promise.all(r.map(q,{url:t}))}},L={};function S(e,t,r,n,o){const s=L[t]||[t],{length:a}=s;for(let t=0;t<a;t+=1){const a=s[t];`on${a}`in r&&r[e](a,n,o)}}async function q(e){const{url:t}=this;await e(t)}function E(e,t){const{window:r}=e,{Request:n}=r,{init:o,url:s}=function(e,t){const{credentials:r,redirect:n,window:o}=e,{FormData:s,Headers:a,URL:i,URLSearchParams:c}=o,{action:l,elements:u,href:h}=t,d=(t.method||"GET").toUpperCase(),f=!["GET","HEAD"].includes(d),p=new i(l||h||t.ownerDocument.location.href);if(u&&!f){const e=[p.search,new s(t)].filter(M);p.search=new c(e.join("&")).toString()}return{init:{...f&&{body:new s(t)},credentials:r,headers:new a({"X-Requested-With":"XMLHttpRequest"}),method:d,redirect:n},url:p.toString()}}(e,t);return new n(s,o)}function M(e){return e.toString().length}function H({target:{classList:e},type:t}){"input"===t?e.add("highlighted"):e.remove("highlighted")}L.blur=["blur","touchcancel","touchleave"],L.blur.listener=function(e,t){return e.call(this,t)},L.click=["click","touchend"],L.click.listener=function(e,t){if(!t.touches||1===t.touches.length)return e.call(this,t)},L.focus=["focus","touchstart"],L.focus.listener=L.blur.listener,g("body:not(.anticore) [data-sse]",(e=>{y(e.dataset.sse)})),g("form input, form select, form textarea",(e=>{m("input",e,H,{passive:!0}),m("blur",e,H,{passive:!0})})),g("main.congrats",(e=>{e.querySelector("h1").classList.add("success")})),f();g(".anticore > [data-before], .anticore > [data-after], .anticore > [data-prepend], .anticore > [data-append], .anticore > [data-replace]",(e=>{const{dataset:t,ownerDocument:r}=e,{after:n,append:o,before:s,prepend:a,replace:i}=t,[c]=[n,o,s,a,i].filter(Boolean),l=new Map([[n,"after"],[o,"append"],[s,"before"],[a,"prepend"],[i,"replaceWith"]]).get(c);r.querySelector(c)?.[l](e)}));const P=new WeakMap,{history:R}=globalThis,D=({outerHTML:e})=>e,k=e=>{const{name:t,nodeName:r,property:n,ownerDocument:o}=e,s=r.toLowerCase(),a="meta"!==s?s:`${s}[${t?"name":"property"}="${t||n}"]`;o.querySelector(a).replaceWith(e)};m("popstate",globalThis,(({state:e})=>{const t=w(e,globalThis.document.location.href);P.set(t,!0),b(t)}));g("main",((e,t)=>{const{ownerDocument:r}=e,n=e.getRootNode(),o=e.closest("body"),s=n.querySelector("title"),a=[s,...n.querySelectorAll("meta[name], meta[property]"),e],i=[a.map(D).join(""),s.innerHTML,t];r.contains(e)?R.replaceState(...i):(a.forEach(k),P.has(o)&&e.classList.contains("error")||R.pushState(...i),globalThis.location.hash||globalThis.scrollTo(0,0))})),b();
